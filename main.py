import json
import random
from datetime import datetime
from pathlib import Path
from typing import Dict, Any

from astrbot.api.event import filter, AstrMessageEvent
from astrbot.api.star import Context, Star, register
from astrbot.api import logger

# äººå“å€¼æ–‡æ¡ˆï¼ˆå®Œæ•´ï¼‰
jrrp_text: Dict[int, str] = {
    0: "ä»Šæ—¥è¿åŠ¿ï¼šå‡¶ âš ï¸ è¯¸äº‹ä¸å®œï¼Œå»ºè®®å®…å®¶ä¿å¹³å®‰",
    1: "ä»Šæ—¥è¿åŠ¿ï¼šå‡¶ âš ï¸ è¿åŠ¿æå·®ï¼Œé¿å…ä»»ä½•å†’é™©",
    2: "ä»Šæ—¥è¿åŠ¿ï¼šå‡¶ âš ï¸ å®¹æ˜“å‘ç”Ÿå†²çªï¼Œä¿æŒå†·é™",
    3: "ä»Šæ—¥è¿åŠ¿ï¼šå‡¶ âš ï¸ å¥åº·è¿åŠ¿ä½è¿·ï¼Œå¤šä¼‘æ¯",
    4: "ä»Šæ—¥è¿åŠ¿ï¼šå‡¶ âš ï¸ è´¢è¿ä¸æµï¼Œè°¨æ…æ¶ˆè´¹",
    5: "ä»Šæ—¥è¿åŠ¿ï¼šå‡¶ âš ï¸ å·¥ä½œå­¦ä¹ æ•ˆç‡ä½ï¼Œä¸è¦å¼ºæ±‚",
    6: "ä»Šæ—¥è¿åŠ¿ï¼šå‡¶ âš ï¸ äººé™…å…³ç³»æ˜“æœ‰è¯¯ä¼šï¼Œå°‘è¨€ä¸ºå¦™",
    7: "ä»Šæ—¥è¿åŠ¿ï¼šå‡¶ âš ï¸ æƒ…ç»ªä¸ç¨³å®šï¼Œé¿å…å†³ç­–",
    8: "ä»Šæ—¥è¿åŠ¿ï¼šå‡¶ âš ï¸ å¯èƒ½ä¸¢å¤±ç‰©å“ï¼Œæ³¨æ„ä¿ç®¡",
    9: "ä»Šæ—¥è¿åŠ¿ï¼šå‡¶ âš ï¸ å‡ºè¡Œä¸åˆ©ï¼Œå°½é‡ç•™å®ˆ",
    10: "ä»Šæ—¥è¿åŠ¿ï¼šå‡¶ âš ï¸ æ•´ä½“è¿ç¨‹å·®ï¼Œè€å¿ƒåº¦è¿‡",
    11: "ä»Šæ—¥è¿åŠ¿ï¼šä½è¿· ğŸŒ§ï¸ å‡ºé—¨è®°å¾—å¸¦ä¼ï¼Œå°å¿ƒæ°´é€†",
    12: "ä»Šæ—¥è¿åŠ¿ï¼šä½è¿· ğŸŒ§ï¸ è¿åŠ¿ä½è¿·ï¼Œå‡¡äº‹æ…¢è¡Œ",
    13: "ä»Šæ—¥è¿åŠ¿ï¼šä½è¿· ğŸŒ§ï¸ å¯èƒ½é‡åˆ°å»¶è¯¯ï¼Œä¿æŒè€å¿ƒ",
    14: "ä»Šæ—¥è¿åŠ¿ï¼šä½è¿· ğŸŒ§ï¸ å¿ƒæƒ…å®¹æ˜“éƒé—·ï¼Œæ‰¾ç‚¹ä¹å­",
    15: "ä»Šæ—¥è¿åŠ¿ï¼šä½è¿· ğŸŒ§ï¸ å·¥ä½œè¿›å±•ç¼“æ…¢ï¼Œä¸è¦æ€¥èº",
    16: "ä»Šæ—¥è¿åŠ¿ï¼šä½è¿· ğŸŒ§ï¸ è´¢è¿å¹³å¹³ï¼Œé¿å…å¤§ç¬”å¼€æ”¯",
    17: "ä»Šæ—¥è¿åŠ¿ï¼šä½è¿· ğŸŒ§ï¸ å¥åº·æ³¨æ„æ„Ÿå†’ï¼Œä¿æš–é˜²å¯’",
    18: "ä»Šæ—¥è¿åŠ¿ï¼šä½è¿· ğŸŒ§ï¸ äººé™…å…³ç³»ä¸€èˆ¬ï¼Œå°‘ç®¡é—²äº‹",
    19: "ä»Šæ—¥è¿åŠ¿ï¼šä½è¿· ğŸŒ§ï¸ å­¦ä¹ æ•ˆç‡ä¸é«˜ï¼Œæ¸©æ•…çŸ¥æ–°",
    20: "ä»Šæ—¥è¿åŠ¿ï¼šä½è¿· ğŸŒ§ï¸ æ•´ä½“è¿åŠ¿ä¸ä½³ï¼ŒæœŸå¾…æ˜å¤©",
    21: "ä»Šæ—¥è¿åŠ¿ï¼šå¹³å¹³ â˜ï¸ ä¿æŒå¹³å¸¸å¿ƒï¼Œç¨³ä¸­æ±‚è¿›",
    22: "ä»Šæ—¥è¿åŠ¿ï¼šå¹³å¹³ â˜ï¸ è¿åŠ¿å¹³ç¨³ï¼ŒæŒ‰éƒ¨å°±ç­",
    23: "ä»Šæ—¥è¿åŠ¿ï¼šå¹³å¹³ â˜ï¸ æ— é£æ— æµªï¼Œäº«å—å¹³æ·¡",
    24: "ä»Šæ—¥è¿åŠ¿ï¼šå¹³å¹³ â˜ï¸ å·¥ä½œå­¦ä¹ æ­£å¸¸å‘æŒ¥",
    25: "ä»Šæ—¥è¿åŠ¿ï¼šå¹³å¹³ â˜ï¸ è´¢è¿ä¸€èˆ¬ï¼Œæ”¶æ”¯å¹³è¡¡",
    26: "ä»Šæ—¥è¿åŠ¿ï¼šå¹³å¹³ â˜ï¸ å¥åº·æ— æ™ï¼Œä¿æŒä¹ æƒ¯",
    27: "ä»Šæ—¥è¿åŠ¿ï¼šå¹³å¹³ â˜ï¸ äººé™…å…³ç³»å’Œè°ï¼Œç®€å•ç›¸å¤„",
    28: "ä»Šæ—¥è¿åŠ¿ï¼šå¹³å¹³ â˜ï¸ é€‚åˆ routine äº‹åŠ¡",
    29: "ä»Šæ—¥è¿åŠ¿ï¼šå¹³å¹³ â˜ï¸ ä¸å®œå†’é™©ï¼Œä¿å®ˆä¸ºå®œ",
    30: "ä»Šæ—¥è¿åŠ¿ï¼šå¹³å¹³ â˜ï¸ æ•´ä½“å¹³é¡ºï¼Œå°æœ‰æ”¶è·",
    31: "ä»Šæ—¥è¿åŠ¿ï¼šå°å‰ ğŸŒ¤ï¸ å°äº‹é¡ºåˆ©ï¼Œå¤§äº‹éœ€è°¨æ…",
    32: "ä»Šæ—¥è¿åŠ¿ï¼šå°å‰ ğŸŒ¤ï¸ è¿åŠ¿æ¸ä½³ï¼ŒæŠŠæ¡å°æœºä¼š",
    33: "ä»Šæ—¥è¿åŠ¿ï¼šå°å‰ ğŸŒ¤ï¸ å¿ƒæƒ…ä¸é”™ï¼Œé€‚åˆç¤¾äº¤",
    34: "ä»Šæ—¥è¿åŠ¿ï¼šå°å‰ ğŸŒ¤ï¸ å·¥ä½œæœ‰è¿›å±•ï¼Œç»§ç»­åŠªåŠ›",
    35: "ä»Šæ—¥è¿åŠ¿ï¼šå°å‰ ğŸŒ¤ï¸ è´¢è¿å°æœ‰æ”¶è·ï¼Œä½†å‹¿è´ªå¿ƒ",
    36: "ä»Šæ—¥è¿åŠ¿ï¼šå°å‰ ğŸŒ¤ï¸ å¥åº·è‰¯å¥½ï¼Œä¿æŒè¿åŠ¨",
    37: "ä»Šæ—¥è¿åŠ¿ï¼šå°å‰ ğŸŒ¤ï¸ äººé™…å…³ç³»èæ´½ï¼Œå¸®åŠ©ä»–äºº",
    38: "ä»Šæ—¥è¿åŠ¿ï¼šå°å‰ ğŸŒ¤ï¸ é€‚åˆå­¦ä¹ æ–°çŸ¥è¯†",
    39: "ä»Šæ—¥è¿åŠ¿ï¼šå°å‰ ğŸŒ¤ï¸ å‡ºè¡Œé¡ºåˆ©ï¼Œä½†æ³¨æ„å®‰å…¨",
    40: "ä»Šæ—¥è¿åŠ¿ï¼šå°å‰ ğŸŒ¤ï¸ æ•´ä½“å‰åˆ©ï¼Œç§¯æè¡ŒåŠ¨",
    41: "ä»Šæ—¥è¿åŠ¿ï¼šä¸­å¹³ ğŸ“Š æ•´ä½“å¹³ç¨³ï¼Œå¯å°è¯•æ–°è®¡åˆ’",
    42: "ä»Šæ—¥è¿åŠ¿ï¼šä¸­å¹³ ğŸ“Š è¿åŠ¿ä¸­ç­‰ï¼Œé€‚åˆè§„åˆ’",
    43: "ä»Šæ—¥è¿åŠ¿ï¼šä¸­å¹³ ğŸ“Š å·¥ä½œå­¦ä¹ ç¨³å®šï¼Œå¯»æ±‚çªç ´",
    44: "ä»Šæ—¥è¿åŠ¿ï¼šä¸­å¹³ ğŸ“Š è´¢è¿ä¸€èˆ¬ï¼Œè€ƒè™‘æŠ•èµ„",
    45: "ä»Šæ—¥è¿åŠ¿ï¼šä¸­å¹³ ğŸ“Š å¥åº·å¹³ç¨³ï¼Œæ³¨æ„é¥®é£Ÿ",
    46: "ä»Šæ—¥è¿åŠ¿ï¼šä¸­å¹³ ğŸ“Š äººé™…å…³ç³»æ­£å¸¸ï¼Œå¤šæ²Ÿé€š",
    47: "ä»Šæ—¥è¿åŠ¿ï¼šä¸­å¹³ ğŸ“Š é€‚åˆæ€»ç»“åæ€",
    48: "ä»Šæ—¥è¿åŠ¿ï¼šä¸­å¹³ ğŸ“Š ä¸å®œå¤§å¹…å˜åŠ¨",
    49: "ä»Šæ—¥è¿åŠ¿ï¼šä¸­å¹³ ğŸ“Š å°æœ‰å‹åŠ›ï¼Œå¦¥å–„å¤„ç†",
    50: "ä»Šæ—¥è¿åŠ¿ï¼šä¸­å¹³ ğŸ“Š æ•´ä½“å¯æ§ï¼Œä¿æŒå¹³è¡¡",
    51: "ä»Šæ—¥è¿åŠ¿ï¼šå°æ—º ğŸ“ˆ é€‚åˆå­¦ä¹ å·¥ä½œï¼Œæ•ˆç‡æå‡",
    52: "ä»Šæ—¥è¿åŠ¿ï¼šå°æ—º ğŸ“ˆ è¿åŠ¿ä¸Šå‡ï¼Œç§¯æè¡ŒåŠ¨",
    53: "ä»Šæ—¥è¿åŠ¿ï¼šå°æ—º ğŸ“ˆ å·¥ä½œé¡ºåˆ©ï¼Œæœ‰æœ›è¿›æ­¥",
    54: "ä»Šæ—¥è¿åŠ¿ï¼šå°æ—º ğŸ“ˆ å­¦ä¹ æ•ˆç‡é«˜ï¼ŒæŠ“ä½æ—¶æœº",
    55: "ä»Šæ—¥è¿åŠ¿ï¼šå°æ—º ğŸ“ˆ è´¢è¿æ¸æ—ºï¼Œå°è¯•ç‰›åˆ€",
    56: "ä»Šæ—¥è¿åŠ¿ï¼šå°æ—º ğŸ“ˆ å¥åº·è¿ä½³ï¼Œç²¾åŠ›å……æ²›",
    57: "ä»Šæ—¥è¿åŠ¿ï¼šå°æ—º ğŸ“ˆ äººé™…å…³ç³»å‹å¥½ï¼Œåˆä½œé¡ºåˆ©",
    58: "ä»Šæ—¥è¿åŠ¿ï¼šå°æ—º ğŸ“ˆ é€‚åˆå¼€å§‹æ–°é¡¹ç›®",
    59: "ä»Šæ—¥è¿åŠ¿ï¼šå°æ—º ğŸ“ˆ æ•´ä½“è¿åŠ¿å‘å¥½ï¼Œä¿æŒåŠªåŠ›",
    60: "ä»Šæ—¥è¿åŠ¿ï¼šå°æ—º ğŸ“ˆ å°æœ‰æˆå°±ï¼Œå†æ¥å†å‰",
    61: "ä»Šæ—¥è¿åŠ¿ï¼šå‰ ğŸ€ æœºä¼šå¢å¤šï¼Œæ³¨æ„æŠŠæ¡æ—¶æœº",
    62: "ä»Šæ—¥è¿åŠ¿ï¼šå‰ ğŸ€ è¿åŠ¿å‰åˆ©ï¼Œä¸»åŠ¨äº‰å–",
    63: "ä»Šæ—¥è¿åŠ¿ï¼šå‰ ğŸ€ å·¥ä½œæœ‰å¥½æœºä¼šï¼Œå±•ç¤ºèƒ½åŠ›",
    64: "ä»Šæ—¥è¿åŠ¿ï¼šå‰ ğŸ€ å­¦ä¹ æœ‰çµæ„Ÿï¼Œæ·±å…¥å­¦ä¹ ",
    65: "ä»Šæ—¥è¿åŠ¿ï¼šå‰ ğŸ€ è´¢è¿ä¸é”™ï¼Œå¯èƒ½æœ‰æ„å¤–çš„",
    66: "ä»Šæ—¥è¿åŠ¿ï¼šå‰ ğŸ€ å¥åº·è¿å¥½ï¼Œäº«å—ç”Ÿæ´»",
    67: "ä»Šæ—¥è¿åŠ¿ï¼šå‰ ğŸ€ äººé™…å…³ç³»æ—ºï¼Œå¹¿ç»“å–„ç¼˜",
    68: "ä»Šæ—¥è¿åŠ¿ï¼šå‰ ğŸ€ é€‚åˆå†³ç­–å’Œè¡ŒåŠ¨",
    69: "ä»Šæ—¥è¿åŠ¿ï¼šå‰ ğŸ€ æ•´ä½“é¡ºåˆ©ï¼Œå¿ƒæƒ³äº‹æˆ",
    70: "ä»Šæ—¥è¿åŠ¿ï¼šå‰ ğŸ€ å¹¸è¿ç›¸ä¼´ï¼Œå‹‡æ•¢å°è¯•",
    71: "ä»Šæ—¥è¿åŠ¿ï¼šå¤§å‰ âœ¨ è´µäººè¿æ—ºï¼Œåˆä½œäº‹é¡¹é¡ºåˆ©",
    72: "ä»Šæ—¥è¿åŠ¿ï¼šå¤§å‰ âœ¨ è¿åŠ¿å¤§å‰ï¼Œå¤§äº‹å¯æˆ",
    73: "ä»Šæ—¥è¿åŠ¿ï¼šå¤§å‰ âœ¨ å·¥ä½œå¾—å¿ƒåº”æ‰‹ï¼Œè·å¾—è®¤å¯",
    74: "ä»Šæ—¥è¿åŠ¿ï¼šå¤§å‰ âœ¨ å­¦ä¹ çªç ´ï¼Œæˆç»©æå‡",
    75: "ä»Šæ—¥è¿åŠ¿ï¼šå¤§å‰ âœ¨ è´¢è¿äº¨é€šï¼ŒæŠ•èµ„è·åˆ©",
    76: "ä»Šæ—¥è¿åŠ¿ï¼šå¤§å‰ âœ¨ å¥åº·è¿å¼ºï¼Œæ´»åŠ›å››å°„",
    77: "ä»Šæ—¥è¿åŠ¿ï¼šå¤§å‰ âœ¨ äººé™…å…³ç³»æä½³ï¼Œé‡åˆ°è´µäºº",
    78: "ä»Šæ—¥è¿åŠ¿ï¼šå¤§å‰ âœ¨ é€‚åˆç­¾çº¦å’Œåˆä½œ",
    79: "ä»Šæ—¥è¿åŠ¿ï¼šå¤§å‰ âœ¨ æ•´ä½“è¿ç¨‹ç¿çƒ‚ï¼Œç§¯æè¿›å–",
    80: "ä»Šæ—¥è¿åŠ¿ï¼šå¤§å‰ âœ¨ å¥½è¿è¿è¿ï¼ŒæŠŠæ¡æœºé‡",
    81: "ä»Šæ—¥è¿åŠ¿ï¼šçˆ†æ£š ğŸŒŸ é€‚åˆæŠ½å¡/ä¹°å½©ç¥¨ï¼",
    82: "ä»Šæ—¥è¿åŠ¿ï¼šçˆ†æ£š ğŸŒŸ è¿åŠ¿çˆ†æ£šï¼ŒæƒŠå–œä¸æ–­",
    83: "ä»Šæ—¥è¿åŠ¿ï¼šçˆ†æ£š ğŸŒŸ å·¥ä½œå­¦ä¹ è¶…å¸¸å‘æŒ¥",
    84: "ä»Šæ—¥è¿åŠ¿ï¼šçˆ†æ£š ğŸŒŸ è´¢è¿æä½³ï¼Œå¤§èƒ†è¡ŒåŠ¨",
    85: "ä»Šæ—¥è¿åŠ¿ï¼šçˆ†æ£š ğŸŒŸ å¥åº·è¿æ»¡åˆ†ï¼Œå……æ»¡èƒ½é‡",
    86: "ä»Šæ—¥è¿åŠ¿ï¼šçˆ†æ£š ğŸŒŸ äººé™…å…³ç³»ç«çˆ†ï¼Œå—æ¬¢è¿",
    87: "ä»Šæ—¥è¿åŠ¿ï¼šçˆ†æ£š ğŸŒŸ é€‚åˆå†’é™©å’Œå°è¯•",
    88: "ä»Šæ—¥è¿åŠ¿ï¼šçˆ†æ£š ğŸŒŸ æ•´ä½“è¿æ°”æå¥½ï¼Œå¿ƒæƒ³äº‹æˆ",
    89: "ä»Šæ—¥è¿åŠ¿ï¼šçˆ†æ£š ğŸŒŸ å¹¸è¿å¥³ç¥å¾®ç¬‘ï¼ŒæŠ“ä½æœºä¼š",
    90: "ä»Šæ—¥è¿åŠ¿ï¼šçˆ†æ£š ğŸŒŸ å¥½äº‹æˆåŒï¼Œäº«å—å½“ä¸‹",
    91: "ä»Šæ—¥è¿åŠ¿ï¼šå¤©å‘½ä¹‹å­ ğŸ† å¿ƒæƒ³äº‹æˆï¼Œå¥½è¿è¿è¿",
    92: "ä»Šæ—¥è¿åŠ¿ï¼šå¤©å‘½ä¹‹å­ ğŸ† è¿åŠ¿æ— æ•Œï¼Œä¸€åˆ‡é¡ºåˆ©",
    93: "ä»Šæ—¥è¿åŠ¿ï¼šå¤©å‘½ä¹‹å­ ğŸ† å·¥ä½œè¾¾åˆ°å·…å³°ï¼Œè·å¾—æˆå°±",
    94: "ä»Šæ—¥è¿åŠ¿ï¼šå¤©å‘½ä¹‹å­ ğŸ† å­¦ä¹ å®Œç¾ï¼Œç†è§£æ·±åˆ»",
    95: "ä»Šæ—¥è¿åŠ¿ï¼šå¤©å‘½ä¹‹å­ ğŸ† è´¢è¿çˆ†è¡¨ï¼Œè´¢å¯Œæ»šæ»š",
    96: "ä»Šæ—¥è¿åŠ¿ï¼šå¤©å‘½ä¹‹å­ ğŸ† å¥åº·æä½³ï¼Œèº«å¿ƒæ„‰æ‚¦",
    97: "ä»Šæ—¥è¿åŠ¿ï¼šå¤©å‘½ä¹‹å­ ğŸ† äººé™…å…³ç³»å®Œç¾ï¼Œæ”¯æŒä¼—å¤š",
    98: "ä»Šæ—¥è¿åŠ¿ï¼šå¤©å‘½ä¹‹å­ ğŸ† é€‚åˆä»»ä½•æŒ‘æˆ˜",
    99: "ä»Šæ—¥è¿åŠ¿ï¼šå¤©å‘½ä¹‹å­ ğŸ† æ•´ä½“è¿ç¨‹å®Œç¾ï¼Œäº«å—æˆåŠŸ",
    100: "ä»Šæ—¥è¿åŠ¿ï¼šå¤©å‘½ä¹‹å­ ğŸ† å¤©é€‰ä¹‹äººï¼Œæ— æ‰€ä¸èƒ½",
}


def get_jrrp_text(jrrp: int) -> str:
    """æ ¹æ®äººå“å€¼è·å–å¯¹åº”çš„æ–‡æ¡ˆ"""
    return jrrp_text.get(jrrp, "è¿™ä¸ªäººä»Šå¤©è¿˜æ²¡æµ‹è¿‡äººå“")


def get_data_file_path() -> Path:
    """è·å–æ•°æ®æ–‡ä»¶è·¯å¾„"""
    plugin_dir = Path(__file__).parent
    data_dir = plugin_dir / "data"
    data_dir.mkdir(exist_ok=True)
    return data_dir / "jrrp_data.json"


def load_jrrp_data() -> Dict[str, Any]:
    """ä»JSONæ–‡ä»¶åŠ è½½æ•°æ®ï¼Œå¦‚æœæ—¥æœŸä¸æ˜¯ä»Šå¤©åˆ™é‡ç½®"""
    today = str(datetime.now().date())
    try:
        data_file = get_data_file_path()
        if data_file.exists():
            with open(data_file, 'r', encoding='utf-8') as f:
                data: Dict[str, Any] = json.load(f)
                if data.get('last_updated_date') != today:
                    logger.info("æ£€æµ‹åˆ°æ—¥æœŸå˜æ›´ï¼Œé‡ç½®äººå“æ•°æ®")
                    return {'last_updated_date': today, 'users': {}}
                return data
        return {'last_updated_date': today, 'users': {}}
    except Exception as e:
        logger.error(f"åŠ è½½äººå“æ•°æ®å¤±è´¥: {e}")
        return {'last_updated_date': today, 'users': {}}


def save_jrrp_data(data: Dict[str, Any]) -> None:
    """ä¿å­˜æ•°æ®åˆ°JSONæ–‡ä»¶ï¼Œå¹¶æ›´æ–°æ—¥æœŸ"""
    try:
        data['last_updated_date'] = str(datetime.now().date())
        with open(get_data_file_path(), 'w', encoding='utf-8') as f:
            json.dump(data, f, ensure_ascii=False, indent=2)
    except Exception as e:
        logger.error(f"ä¿å­˜äººå“æ•°æ®å¤±è´¥: {e}")


@register("jrrp", "kuank", "ä¸€ä¸ªæ¯æ—¥ç”Ÿæˆä¸€æ¬¡äººå“å€¼çš„æ’ä»¶", "1.0.6", "https://github.com/kuankqaq/astr_bot_jrrp")
class JrrpPlugin(Star):
    """Jrrp æ’ä»¶ï¼šæ¯æ—¥ç”Ÿæˆå¹¶æŒä¹…åŒ–ä¿å­˜ç”¨æˆ·äººå“å€¼"""

    def __init__(self, context: Context):
        super().__init__(context)
        self.jrrp_data: Dict[str, Any] = load_jrrp_data()
        logger.info("Jrrp æ’ä»¶ (JSONæŒä¹…åŒ–ç‰ˆ) åŠ è½½æˆåŠŸã€‚æ•°æ®å·²ä»æ–‡ä»¶åŠ è½½ã€‚")

    @filter.command("jrrp", alias={'ä»Šæ—¥äººå“'})
    async def jrrp(self, event: AstrMessageEvent):
        """å¤„ç† /jrrp æŒ‡ä»¤ï¼Œç”Ÿæˆæˆ–è¿”å›ç”¨æˆ·ä»Šæ—¥äººå“å€¼"""
        user_id: str = event.get_sender_id()
        today: str = str(datetime.now().date())

        if self.jrrp_data.get('last_updated_date') != today:
            self.jrrp_data = {'last_updated_date': today, 'users': {}}
            save_jrrp_data(self.jrrp_data)

        user_data: Dict[str, Any] = self.jrrp_data['users'].get(user_id, {})
        if user_data.get('date') != today:
            new_jrrp: int = random.randint(0, 100)
            self.jrrp_data['users'][user_id] = {'date': today, 'jrrp': new_jrrp}
            save_jrrp_data(self.jrrp_data)

        user_jrrp: int = self.jrrp_data['users'][user_id]['jrrp']
        message: str = f"{event.get_sender_name()} ä»Šå¤©çš„äººå“å€¼æ˜¯: {user_jrrp}\n{get_jrrp_text(user_jrrp)}"
        yield event.plain_result(message)
